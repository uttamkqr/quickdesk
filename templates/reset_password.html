{% extends 'base.html' %}

{% block title %}Reset Password - QuickDesk{% endblock %}

{% block content %}
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden w-full max-w-md animate-form">
        <div class="p-8">

        <!-- Logo -->
        <div class="flex justify-center mb-8">
            <div class="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center">
                <i class="fas fa-lock-open text-white text-3xl"></i>
            </div>
        </div>

        <!-- Heading -->
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">Reset Your Password</h1>
        <p class="text-gray-600 text-center mb-8">
            Enter your new password below. Make sure it's strong and secure!
        </p>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-4 space-y-2">
                    {% for category, msg in messages %}
                        <div class="px-4 py-3 rounded-lg text-white font-medium
                  {% if category == 'success' %} bg-green-500 
                  {% elif category == 'danger' %} bg-red-500
                  {% elif category == 'warning' %} bg-yellow-500
                  {% else %} bg-gray-500 {% endif %}">
                            {{ msg }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Reset Password Form -->
        <form method="POST" id="resetForm" class="space-y-6">
            <div class="space-y-2">
                <label for="password" class="block text-sm font-medium text-gray-700">
                    <i class="fas fa-key mr-1"></i> New Password
                </label>
                <div class="relative">
                    <input
                            name="password"
                            type="password"
                            id="password"
                            placeholder="Enter new password"
                            required
                            minlength="6"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors"
                    >
                    <i class="fas fa-lock absolute right-3 top-3.5 text-gray-400"></i>
                </div>
                <!-- Password Strength Indicator -->
                <div class="password-strength bg-gray-200" id="strengthBar"></div>
                <p class="text-xs text-gray-500">
                    Minimum 6 characters. Use a mix of letters, numbers, and symbols for better security.
                </p>
            </div>

          <div class="space-y-2">
              <label for="confirm_password" class="block text-sm font-medium text-gray-700">
                  <i class="fas fa-check-circle mr-1"></i> Confirm Password
              </label>
              <div class="relative">
                  <input
                          name="confirm_password"
                          type="password"
                          id="confirm_password"
                          placeholder="Confirm new password"
                          required
                          minlength="6"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors"
                  >
                  <i class="fas fa-lock absolute right-3 top-3.5 text-gray-400"></i>
              </div>
              <p class="text-xs" id="matchMessage"></p>
        </div>

          <button
                  type="submit"
                  id="submitBtn"
                  class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 flex items-center justify-center"
          >
              <i class="fas fa-check mr-2"></i>
              Reset Password
          </button>
      </form>

        <!-- Divider -->
        <div class="relative my-6">
            <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-300"></div>
            </div>
        </div>

        <!-- Back to Login -->
        <div class="text-center">
            <a href="{{ url_for('auth.login') }}"
               class="text-green-600 hover:text-green-800 font-medium inline-flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Login
            </a>
        </div>

        <!-- Security Note -->
        <div class="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
            <p class="text-sm text-green-800 flex items-start">
                <i class="fas fa-shield-alt mt-0.5 mr-2"></i>
                <span>
            <strong>Security Tip:</strong> After resetting your password, you'll be logged out from all devices. You'll need to log in again with your new password.
          </span>
            </p>
        </div>

    </div>
  </div>

<!-- JavaScript for password validation -->
<script>
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const strengthBar = document.getElementById('strengthBar');
    const matchMessage = document.getElementById('matchMessage');
    const form = document.getElementById('resetForm');

    // Password strength checker
    password.addEventListener('input', function () {
        const value = this.value;
        let strength = 0;

        if (value.length >= 6) strength++;
        if (value.length >= 10) strength++;
        if (/[a-z]/.test(value) && /[A-Z]/.test(value)) strength++;
        if (/\d/.test(value)) strength++;
        if (/[^a-zA-Z0-9]/.test(value)) strength++;

        // Update strength bar
        if (strength === 0) {
            strengthBar.style.width = '0%';
            strengthBar.classList.remove('bg-red-500', 'bg-yellow-500', 'bg-green-500');
        } else if (strength <= 2) {
            strengthBar.style.width = '33%';
            strengthBar.classList.remove('bg-yellow-500', 'bg-green-500');
            strengthBar.classList.add('bg-red-500');
        } else if (strength <= 4) {
            strengthBar.style.width = '66%';
            strengthBar.classList.remove('bg-red-500', 'bg-green-500');
            strengthBar.classList.add('bg-yellow-500');
        } else {
            strengthBar.style.width = '100%';
            strengthBar.classList.remove('bg-red-500', 'bg-yellow-500');
            strengthBar.classList.add('bg-green-500');
        }
    });

    // Password match checker
    function checkPasswordMatch() {
        if (confirmPassword.value === '') {
            matchMessage.textContent = '';
            return;
        }

        if (password.value === confirmPassword.value) {
            matchMessage.textContent = '✓ Passwords match';
            matchMessage.classList.remove('text-red-600');
            matchMessage.classList.add('text-green-600');
        } else {
            matchMessage.textContent = '✗ Passwords do not match';
            matchMessage.classList.remove('text-green-600');
            matchMessage.classList.add('text-red-600');
        }
    }

    password.addEventListener('input', checkPasswordMatch);
    confirmPassword.addEventListener('input', checkPasswordMatch);

    // Form validation
    form.addEventListener('submit', function (e) {
        if (password.value !== confirmPassword.value) {
            e.preventDefault();
            alert('⚠️ Passwords do not match!');
        } else if (password.value.length < 6) {
            e.preventDefault();
            alert('⚠️ Password must be at least 6 characters long!');
        }
    });
  </script>

</body>
</html>
